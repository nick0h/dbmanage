{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-history me-2"></i>Request Change Logs
                </h2>
                <div>
                    <a href="{% url 'home' %}" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-home me-2"></i>Home
                    </a>
                    <a href="{% url 'admin:index' %}" class="btn btn-primary">
                        <i class="fas fa-cogs me-2"></i>Admin
                    </a>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>Select Request ID to View Change History
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-4">Click on any request ID below to view its complete change history and all snapshots.</p>
                            
                            <!-- Staining Requests -->
                            {% if staining_requests %}
                            <div class="mb-4">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-vial me-2"></i>Staining Requests
                                </h6>
                                <div class="row">
                                    {% for request in staining_requests %}
                                    <div class="col-md-3 col-sm-4 col-6 mb-2">
                                        <a href="{% url 'staining_request_history' request.key %}" class="btn btn-outline-primary btn-sm w-100">
                                            <strong>#{{ request.key }}</strong><br>
                                            <small class="text-muted">{{ request.requestor.name|truncatechars:15 }}</small>
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Embedding Requests -->
                            {% if embedding_requests %}
                            <div class="mb-4">
                                <h6 class="text-success mb-3">
                                    <i class="fas fa-cube me-2"></i>Embedding Requests
                                </h6>
                                <div class="row">
                                    {% for request in embedding_requests %}
                                    <div class="col-md-3 col-sm-4 col-6 mb-2">
                                        <a href="{% url 'embedding_request_history' request.key %}" class="btn btn-outline-success btn-sm w-100">
                                            <strong>#{{ request.key }}</strong><br>
                                            <small class="text-muted">{{ request.requestor.name|truncatechars:15 }}</small>
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Sectioning Requests -->
                            {% if sectioning_requests %}
                            <div class="mb-4">
                                <h6 class="text-info mb-3">
                                    <i class="fas fa-cut me-2"></i>Sectioning Requests
                                </h6>
                                <div class="row">
                                    {% for request in sectioning_requests %}
                                    <div class="col-md-3 col-sm-4 col-6 mb-2">
                                        <a href="{% url 'sectioning_request_history' request.key %}" class="btn btn-outline-info btn-sm w-100">
                                            <strong>#{{ request.key }}</strong><br>
                                            <small class="text-muted">{{ request.requestor.name|truncatechars:15 }}</small>
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- No requests with logs -->
                            {% if not staining_requests and not embedding_requests and not sectioning_requests %}
                            <div class="text-center py-5">
                                <i class="fas fa-history fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No Change Logs Available</h5>
                                <p class="text-muted">No requests have been created or modified yet. Change logs will appear here once requests are created or edited.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
